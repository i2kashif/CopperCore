{
  "meta": {
    "project": "CopperCore ERP",
    "date": "2025-09-05",
    "prepared_by": "Generated by Software Development Manager"
  },
  "product_overview": "CopperCore ERP is a factory-scoped enterprise resource planning system tailored for wires, cables, and conductors manufacturing and logistics. It provides comprehensive modules covering product family configuration, SKU catalog management, work orders, inventory control, packing, dispatch, invoicing compliant with Pakistan fiscal controls, and real-time UI updates.",
  "core_goals": [
    "Enable secure, factory-scoped access with CEO/global oversight and scoped factory roles.",
    "Model configurable product families driving SKU identity, inventory, packing, and invoicing.",
    "Support efficient end-to-end work order lifecycle including raw material issue/return, production logging, and finished goods receipt.",
    "Manage inventory lots and packing units with barcode support and GS1 SSCC aliasing.",
    "Facilitate packing lists, dispatch notes, inward GRNs optimized for inter-factory transfers with discrepancy management.",
    "Generate compliant invoices with customer SKU cross-references, multi-currency, and GST-ready fiscal controls.",
    "Enforce quality control via configurable QCPs and shipment blocking based on test results.",
    "Provide detailed audit trails with tamper-evident logging for all critical actions.",
    "Deliver realtime user experience with fine-grained cache invalidation and limited websocket chatter.",
    "Offer comprehensive user and factory management with role and scope-based access control."
  ],
  "key_features": [
    "Robust Authentication System featuring CEO login, remember me, and factory-scoped access control.",
    "Manage Company Dashboard allowing CEO to create and manage factories, users, product families, and SKU catalog with copper branding theme.",
    "User Management supporting CRUD operations, dynamic factory assignments, optimistic UI updates, and realtime synchronization.",
    "Factory Management module with CRUD, activation controls, address management, and dropdown integration.",
    "Product Family Configuration with dynamic attributes, SKU naming rules, validation, and support for production appends.",
    "SKU Catalog Management supporting bulk variant generation, creation wizards, pending SKU approval workflow, and on-the-fly SKU creation during FG receipt.",
    "Realtime Updates Infrastructure subscribing to factory-specific channels for minimal and efficient UI updates.",
    "API Service Layer and Backend API supporting RESTful operations with role-based and factory scoping, audit logging, and concurrency control.",
    "Audit System implementing tamper-evident SHA-256 chain linking for all CRUD operations.",
    "UI Component System with copper-themed accessible React components and consistent styling.",
    "Comprehensive TypeScript type system ensuring data integrity and developer productivity."
  ],
  "user_flow_summary": [
    "CEO logs in and navigates to Manage Company Dashboard to create factories, users, and product families.",
    "Factory Manager logs in, accepts work orders, issues and returns raw materials, logs production, and finalizes finished goods receipt.",
    "Factory Worker creates packing units, builds packing lists via scanning, and drafts dispatch notes.",
    "CEO or Director reviews and approves pending SKUs created on-the-fly by Factory Managers.",
    "Dispatch Notes undergo verification and optional CEO/Director approval; rejection flows return them to draft and update PU statuses.",
    "GRN creation scans dispatch notes or finalized packing lists, captures discrepancies, and manages internal rejections with return DNs.",
    "Customer and invoice management includes validating customer SKU mappings and posting invoices with fiscal compliance.",
    "Quality control manages QCP-driven testing at multiple stages with shipment blocking on fails or holds.",
    "Realtime updates notify users of concurrent edits, approvals, and data changes through scoped Supabase realtime subscriptions with debounce and caching.",
    "Audit logs are maintained for all critical operations with tamper-evident chain hashing."
  ],
  "validation_criteria": [
    "Enforce factory scoping on all queries and data visibility except global roles.",
    "Validate SKU uniqueness with SKU naming rules; disallow duplicates and require CEO approval for on-the-fly SKUs.",
    "No returns of raw materials exceed issued quantities per lot; attempts cause validation errors with user hints.",
    "Packing Lists reject QC-blocked lots unless overridden by CEO with auditing.",
    "Dispatch Note rejection returns PUs to available status and logs reasons with UI realtime updates reflecting changes.",
    "GRN discrepancies create records with statuses and require approval before posting.",
    "Invoice posting blocked if customer SKU cross-reference missing, SKU is pending approval, or QC status is HOLD/FAIL.",
    "Audit system generates chained, tamper-evident records for all CRUD and override actions with cryptographic verification.",
    "Realtime cache invalidation targets only changed entities; bulk changes summarize events to avoid UI reloads.",
    "Automated acceptance tests cover critical flows including materials integrity, SKU workflows, barcode reprinting, dispatch verification, GRN discrepancy handling, QC blocking, and realtime update accuracy."
  ],
  "code_summary": {
    "tech_stack": [
      "TypeScript",
      "React 18",
      "Node.js",
      "Fastify",
      "Supabase",
      "PostgreSQL",
      "Vite",
      "TailwindCSS",
      "React Query (@tanstack/react-query)",
      "Zod",
      "Playwright",
      "Vitest",
      "pnpm"
    ],
    "features": [
      {
        "name": "Authentication System",
        "description": "Professional authentication UI with copper branding, CEO login, remember me functionality, and factory-scoped access control",
        "files": [
          "apps/web/src/features/auth/components/LoginForm.tsx",
          "apps/web/src/features/auth/components/AuthLayout.tsx",
          "apps/web/src/features/auth/components/AuthHeader.tsx",
          "apps/web/src/hooks/useCurrentUser.ts"
        ]
      },
      {
        "name": "Manage Company Dashboard",
        "description": "CEO-level management interface for factories, users, product families, and SKU catalog with tabbed navigation and copper theming",
        "files": [
          "apps/web/src/features/manage-company/components/ManageCompany.tsx",
          "apps/web/src/features/manage-company/components/FactoriesTab.tsx",
          "apps/web/src/features/manage-company/components/UsersTab.tsx",
          "apps/web/src/features/manage-company/components/OpeningStockTab.tsx",
          "apps/web/src/features/manage-company/index.ts"
        ]
      },
      {
        "name": "User Management with Factory Scoping",
        "description": "BACK-13 to BACK-16: User CRUD with CEO global visibility, dynamic factory assignments, optimistic updates, and realtime synchronization",
        "files": [
          "apps/web/src/features/manage-company/hooks/useUsers.ts",
          "apps/web/src/features/manage-company/components/UsersTab.tsx",
          "apps/web/src/hooks/useRealtimeUpdates.ts",
          "apps/web/src/services/api/users.ts"
        ]
      },
      {
        "name": "Factory Management",
        "description": "Factory CRUD operations with address management, activation controls, and dynamic dropdown integration for user assignments",
        "files": [
          "apps/web/src/features/manage-company/hooks/useFactories.ts",
          "apps/web/src/features/manage-company/components/FactoriesTab.tsx",
          "apps/web/src/services/api/factories.ts"
        ]
      },
      {
        "name": "Product Family Configuration",
        "description": "Configuration-first product system with dynamic attributes, SKU naming rules, validation, and industry templates",
        "files": [
          "apps/web/src/features/manage-company/hooks/useProductFamilies.ts",
          "apps/web/src/features/manage-company/components/ProductFamiliesTab.tsx",
          "apps/web/src/features/manage-company/types/product-family.ts"
        ]
      },
      {
        "name": "SKU Catalog Management",
        "description": "Complete SKU lifecycle with creation wizard, bulk generation, pending approval workflow, and on-the-fly creation support",
        "files": [
          "apps/web/src/features/manage-company/components/CatalogTab.tsx",
          "apps/web/src/features/manage-company/components/SKUCreationWizard.tsx",
          "apps/web/src/features/manage-company/components/BulkGenerationModal.tsx",
          "apps/web/src/features/manage-company/hooks/useSKUs.ts",
          "apps/web/src/features/manage-company/types/sku.ts"
        ]
      },
      {
        "name": "Realtime Updates Infrastructure",
        "description": "BACK-16: Supabase realtime channels with debounced updates (350ms), factory-scoped subscriptions, and cache invalidation",
        "files": [
          "apps/web/src/hooks/useRealtimeUpdates.ts"
        ]
      },
      {
        "name": "API Service Layer",
        "description": "RESTful API services with error handling, optimistic locking, and factory scoping for all entity operations",
        "files": [
          "apps/web/src/services/api/index.ts",
          "apps/web/src/services/api/factories.ts",
          "apps/web/src/services/api/users.ts"
        ]
      },
      {
        "name": "Backend API Infrastructure",
        "description": "Fastify-based API with Supabase integration, role-based auth, factory scoping, audit logging, and user-factory assignments",
        "files": [
          "apps/api/src/server.ts",
          "apps/api/src/lib/supabase.ts",
          "apps/api/src/middleware/auth.ts",
          "apps/api/src/types/database.ts",
          "apps/api/src/modules/common/types.ts",
          "apps/api/src/modules/common/validation.ts"
        ]
      },
      {
        "name": "Factories API Module",
        "description": "Complete factory CRUD with RLS enforcement, CEO/Director global access, audit logging, and optimistic locking",
        "files": [
          "apps/api/src/modules/factories/service.ts",
          "apps/api/src/modules/factories/routes.ts"
        ]
      },
      {
        "name": "Users API Module",
        "description": "User management API with role-based filtering, factory assignment support, status toggle, and comprehensive validation",
        "files": [
          "apps/api/src/modules/users/service.ts",
          "apps/api/src/modules/users/routes.ts"
        ]
      },
      {
        "name": "User-Factory Assignments API",
        "description": "Many-to-many relationship management for user-factory assignments with bulk operations and assignment statistics",
        "files": [
          "apps/api/src/modules/user-factory-assignments/service.ts",
          "apps/api/src/modules/user-factory-assignments/routes.ts"
        ]
      },
      {
        "name": "Audit System",
        "description": "Tamper-evident audit chain with SHA-256 hash linking, full CRUD operation logging, and chain integrity verification",
        "files": [
          "apps/api/src/modules/audit/service.ts"
        ]
      },
      {
        "name": "UI Component System",
        "description": "Professional copper-themed React components with variants, loading states, accessibility, and consistent styling",
        "files": [
          "apps/web/src/components/ui/Button.tsx",
          "apps/web/src/components/ui/TextField.tsx",
          "apps/web/src/components/ui/Card.tsx",
          "apps/web/src/components/ui/ErrorAlert.tsx"
        ]
      },
      {
        "name": "Type System",
        "description": "Comprehensive TypeScript types for all entities with factory scoping, audit fields, and API response structures",
        "files": [
          "apps/web/src/features/manage-company/types/index.ts",
          "apps/web/src/features/manage-company/types/sku.ts",
          "apps/web/src/features/manage-company/types/product-family.ts",
          "apps/api/src/modules/common/types.ts",
          "packages/shared/src/types/index.ts"
        ]
      }
    ]
  }
}
